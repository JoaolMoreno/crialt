<section class="section-container">
  <div class="form-header">
    <button type="button" class="btn-padrao back-btn" (click)="onBack()">
      <span class="material-icons">arrow_back</span> Voltar
    </button>
    <h1>{{ isEdit ? 'Editar Cliente' : 'Cadastrar Cliente' }}</h1>
  </div>
  <form [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="off" [class.loading]="loading">
    <div class="form-row">
      <div class="form-group">
        <label for="name">Nome/Razão Social</label>
        <input id="name" formControlName="name" type="text" />
        <div class="error" *ngIf="form.get('name')?.invalid && form.get('name')?.touched">Nome obrigatório</div>
      </div>
      <div class="form-group">
        <label for="document">CPF/CNPJ</label>
        <input id="document" formControlName="document" type="text" />
        <select formControlName="document_type">
          <option value="cpf">CPF</option>
          <option value="cnpj">CNPJ</option>
        </select>
        <div class="error" *ngIf="form.get('document')?.errors?.cpfInvalid && form.get('document')?.touched">CPF inválido</div>
        <div class="error" *ngIf="form.get('document')?.errors?.cnpjInvalid && form.get('document')?.touched">CNPJ inválido</div>
        <div class="error" *ngIf="form.get('document')?.invalid && form.get('document')?.touched && !form.get('document')?.errors?.cpfInvalid && !form.get('document')?.errors?.cnpjInvalid">Documento obrigatório</div>
        <div class="error" *ngIf="error && (form.get('document')?.touched || form.get('document_type')?.touched)">{{ error }}</div>
      </div>
      <div class="form-group">
        <label for="rg_ie">RG/IE</label>
        <input id="rg_ie" formControlName="rg_ie" type="text" />
      </div>
      <div class="form-group">
        <label for="birth_date">Data de Nascimento/Fundação</label>
        <input id="birth_date" formControlName="birth_date" type="date" />
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="email">Email</label>
        <input id="email" formControlName="email" type="email" />
        <div class="error" *ngIf="form.get('email')?.invalid && form.get('email')?.touched">Email obrigatório</div>
      </div>
      <div class="form-group">
        <label for="secondary_email">Email Secundário</label>
        <input id="secondary_email" formControlName="secondary_email" type="email" />
      </div>
      <div class="form-group">
        <label for="phone">Telefone</label>
        <input id="phone" formControlName="phone" type="text" />
        <div class="error" *ngIf="form.get('phone')?.invalid && form.get('phone')?.touched">Telefone obrigatório</div>
      </div>
      <div class="form-group">
        <label for="mobile">Celular</label>
        <input id="mobile" formControlName="mobile" type="text" />
      </div>
      <div class="form-group">
        <label for="whatsapp">WhatsApp</label>
        <input id="whatsapp" formControlName="whatsapp" type="text" />
      </div>
    </div>
    <div class="form-row">
      <div formGroupName="address" class="address-group">
        <label>Endereço</label>
        <div class="form-group">
          <input formControlName="zip_code" type="text" placeholder="CEP" />
            <span *ngIf="cepLoading" class="cep-spinner">Buscando...</span>
            <div class="error" *ngIf="cepError">{{ cepError }}</div>
        </div>
        <div class="form-group"><input formControlName="street" type="text" placeholder="Rua" /></div>
        <div class="form-group"><input formControlName="number" type="text" placeholder="Número" /></div>
        <div class="form-group"><input formControlName="complement" type="text" placeholder="Complemento" /></div>
        <div class="form-group"><input formControlName="neighborhood" type="text" placeholder="Bairro" /></div>
        <div class="form-group"><input formControlName="city" type="text" placeholder="Cidade" /></div>
        <div class="form-group"><input formControlName="state" type="text" placeholder="Estado" /></div>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="notes">Observações</label>
        <textarea id="notes" formControlName="notes"></textarea>
      </div>
      <div class="form-group">
        <label for="is_active">Status</label>
        <select id="is_active" formControlName="is_active">
          <option [value]="true">Ativo</option>
          <option [value]="false">Inativo</option>
        </select>
      </div>
    </div>
    <div class="form-row">
<!--      <div class="form-group">-->
<!--        <label>Documentos (RG, CPF, etc.)</label>-->
<!--        <app-file-upload formControlName="documents" [multiple]="true" [acceptedTypes]="['application/pdf','image/*']"></app-file-upload>-->
<!--      </div>-->
      <div class="form-group" *ngIf="isEdit">
        <label>Ações de Senha</label>
        <div class="password-actions">
          <button type="button" class="btn-padrao" (click)="onResetPassword()" [disabled]="loading">Redefinir senha</button>
          <button type="button" class="btn-padrao" (click)="onShowChangePassword()" [disabled]="loading || showChangePassword">Trocar senha</button>
        </div>
        <div *ngIf="showChangePassword" class="change-password-box">
          <div class="change-password-actions">
            <input type="password" [(ngModel)]="newPassword" placeholder="Nova senha" [disabled]="loading" [ngModelOptions]="{standalone: true}" />
            <button type="button" class="btn-padrao" (click)="onConfirmChangePassword()" [disabled]="loading || !newPassword">OK</button>
            <button type="button" class="btn-vermelho" (click)="onCancelChangePassword()" [disabled]="loading">Cancelar</button>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" formControlName="first_access" /> Primeiro acesso (obrigar troca de senha)
        </label>
      </div>
    </div>
    <button type="submit" class="btn-padrao" [disabled]="loading">
      {{ isEdit ? 'Salvar Alterações' : 'Cadastrar Cliente' }}
    </button>
    <app-loading-spinner *ngIf="loading" size="small"></app-loading-spinner>
    <div *ngIf="error && !form.get('document')?.touched" class="form-error">{{ error }}</div>
  </form>
</section>
